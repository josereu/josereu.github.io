<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial de servicio</title>
    <link href="normalize.css" rel="stylesheet">
    <link href="font/style.css" rel="stylesheet">
    <link href="estilo.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;500;700&display=swap" rel="stylesheet">
</head>

<body>
    <div id="contenedor">
        <h3>Búsqueda de historial <br> Taller de Servicio</h3>
        <div id="contenedorBotones">
            <button id="startRecognizeAsyncButton"><i class="icon-mic"></i>Hablar</button>
            <button id="stopRecognizeAsyncButton"><i class="icon-stop"></i>Terminar</button>
            <button id="nuevaBusqueda"><i class="icon-loop2"></i> búsqueda</button>
        </div>
        <div id="contenedorResultado">
            <input id="phraseDiv" type="text">
        </div>
    </div>
</body>
<script src="sdk/microsoft.cognitiveservices.speech.sdk.bundle-min.js"></script>
<script>
    var subscriptionKey = "ee745a61cf044b49b3f0503de9728a18";
    var serviceRegion = "southcentralus";
    var phraseDiv;
    var startRecognizeAsyncButton;
    var stopRecognizeAsyncButton;
    var nuevaBusqueda;
    var SpeechSDK;
    var recognizer;
    document.addEventListener("DOMContentLoaded", function() {
        startRecognizeAsyncButton = document.getElementById("startRecognizeAsyncButton");
        stopRecognizeAsyncButton = document.getElementById("stopRecognizeAsyncButton");
        nuevaBusqueda = document.getElementById("nuevaBusqueda");
        stopRecognizeAsyncButton.disabled = true;
        phraseDiv = document.getElementById("phraseDiv");
        var speechConfig;
        speechConfig = SpeechSDK.SpeechConfig.fromSubscription(subscriptionKey, serviceRegion);
        speechConfig.speechRecognitionLanguage = "es-ES";
        var audioConfig = SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();
        recognizer = new SpeechSDK.SpeechRecognizer(speechConfig, audioConfig);
        startRecognizeAsyncButton.addEventListener("click", function() {
            phraseDiv.value = "";
            startRecognizeAsyncButton.disabled = true;
            stopRecognizeAsyncButton.disabled = false;
            phraseDiv.innerHTML = "";
            recognizer.startContinuousRecognitionAsync();
            recognizer.recognized = function(s, e) {
                var resultado = e.result.text;
                console.log("resultado: " + resultado);
                if (resultado == undefined) {
                    resultado = "¿?";
                    phraseDiv.value += resultado;
                } else {
                    phraseDiv.value += resultado;
                }
            };
        });

        stopRecognizeAsyncButton.addEventListener("click", function() {
            startRecognizeAsyncButton.disabled = false;
            stopRecognizeAsyncButton.disabled = true;
            recognizer.stopContinuousRecognitionAsync();

        });

        nuevaBusqueda.addEventListener("click", function() {
            phraseDiv.value = "";
        });

        if (!!window.SpeechSDK) {
            SpeechSDK = window.SpeechSDK;
            startRecognizeAsyncButton.disabled = false;
            if (typeof RequestAuthorizationToken === "function") {
                RequestAuthorizationToken();
            }
        }
    });
</script>

</html>